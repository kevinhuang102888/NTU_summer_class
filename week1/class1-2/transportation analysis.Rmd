---
title: "Transportation Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## 概論
---



為了環保節能與城市發展，政府積極推廣大眾運輸，大力興建捷運系統、重整公車系統或是規劃城市腳踏車系統，然而並非有了大眾運輸的出現，就能讓民眾從自駕車(汽車、機車)轉為大眾運輸，也應考慮到各個縣市的民眾對交通通勤的習慣、各縣市的大眾運輸建設或年齡層的不同等等因素，全方面的去討論，對於特定族群宣導，才能對症下藥。


## 資料介紹
---

這份資料來自交通部的「交通部統計處民眾日常使用運具狀況調查」，主要資料調查紀錄為各縣市民眾平常日使用運具之情形、民眾未使用公共運輸工具之原因、民眾使用公共運輸工具之滿意度及不滿意的原因。

本次分析主要採用目前最新的調查版本(105年度)，並希望可以調查出「各縣市年齡層使用大眾運輸的使用率百分比」以及「性別是否影響搭乘大眾運輸」的討論

[資料來源](https://data.gov.tw/dataset/6248)



## code介紹
---


1.先將需要的library匯入

```{r}
#import 'dplyr' and 'magrittr'
library(dplyr)
library(magrittr)
```

2.取出需要的資料CSV，並調整fileEncoding為"UTF-8-BOM"，以防亂碼

```{r} 
#load the data
survey <- read.csv("105data.csv",header=TRUE,fileEncoding="UTF-8-BOM")
head(survey,3)
```

3.先初步對資料了解，針對「年齡」和「性別」計算總人數

```{r} 
#information about data(gender/age)
survey2<-survey
survey2%>%
  nrow()%>%
  toString()%>%
  paste('調查人數：',.,'人')%>%
  print()
#gender summary
survey2$v12[survey2$v12==1]<-'male'
survey2$v12[survey2$v12==2]<-'female'
count(survey2,v12,name='人數')
#age summary
survey2$v1[survey2$v1==1]<-'above15'
survey2$v1[survey2$v1==2]<-'under15'
survey2$v13[survey2$v13==1]<-'15-18'
survey2$v13[survey2$v13==2]<-'18-20'
survey2$v13[survey2$v13==3]<-'20-30'
survey2$v13[survey2$v13==4]<-'30-40'
survey2$v13[survey2$v13==5]<-'40-50'
survey2$v13[survey2$v13==6]<-'50-60'
survey2$v13[survey2$v13==7]<-'60-65'
survey2$v13[survey2$v13==8]<-'above65'
count(survey2,v1,name='人數')
count(survey2,v13,name = '人數')
```

4.從資料取出「年齡」、「性別」、「居住地」、「平日主要使用的交通工具」、「教育」以及「工作類型」

```{r} 
#select the data which i want
newdata<-survey %>%
  select(age=v13,sex=v12,location=v2_1,transportation=v6,education=v14,job=v15)
head(newdata)
```

5.將location(包括縣市+鄉里)分配成22個縣市

```{r warning=FALSE}
region<-c('新北市','宜蘭縣','桃園縣','新竹縣','苗栗縣',
          '台中市','彰化縣','南投縣','雲林縣','嘉義縣',
          '台南市','高雄市','屏東縣','台東縣','花蓮縣',
          '澎湖縣','基隆市','新竹市','台中市','嘉義市',
          '台南市','台北市','高雄市','金門縣','連江縣')
for (x in 1:25){
  newdata$location[(as.numeric(newdata$location)%/%100)==x]<-region[x]
}
head(newdata)
```

6.想要分析的問題

Q1:先將年齡分成三個階層，15到20歲、20到60歲以及60歲以上。以各年齡層來說，計算每個縣市的使用大眾運輸百分率。

設計兩個function，一個為找到特定年齡搭乘大眾運輸的資料，另一個是計算特定年齡搭乘大眾運輸除以該年齡層之人數的比率
```{r} 
#get certain part of data (15-20,20-60,60UP)
certaindata<-function(data,expression){
  certain<-data%>%
    select(age,location,transportation)%>%
    filter(expression&transportation>=14&transportation<=18)
  certain
}
#get the rate about whether people commute by public transportation
getrate<-function(data,data2,expression){
  total<-data%>%
    select(age,location,transportation)%>%
    filter(expression)
  h1<-count(total,location)
  h2<-count(data2,location)
  rate<-data.frame(h1[1],1-h2[2]/h1[2])
  rate
}
```

套用function
```{r}
#filter people who ages between 15-20 and between 20-60 and above 60
#age between 15 and 20
expression1<-newdata$age==1|newdata$age==2
youngadult<-certaindata(newdata,expression1)
getrate(newdata,youngadult,expression1)

#age between 20 and 60
expression2<-newdata$age>=3&newdata$age<=6
adult<-certaindata(newdata,expression2)
getrate(newdata,adult,expression2)

#age above 60
expression3<-newdata$age>=7
elder<-certaindata(newdata,expression3)
getrate(newdata,elder,expression3)
```

Q2:「性別」是否會影響搭乘大眾運輸?

```{r} 
#determine the relationship between sex and transportation
sex_VS_transport<-select(newdata,sex,transportation)
head(sex_VS_transport,10)
```